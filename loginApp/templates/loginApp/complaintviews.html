{% load static %}
{% load django_bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        /* Matching font and container style */
        body {
            font-family: 'Times New Roman', Times, serif;
            color: navy;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa; /* A light grey background */
        }
        header {
            background-color: #fff; /* White background for the header */
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,.1); /* A subtle shadow for depth */
            font-size: 1.2rem; /* Larger font size for header */
        }
        .container {
            margin: 2rem auto;
            max-width: 960px; /* Wider container for better layout on desktop */
            padding: 0 1rem;
        }
        .btn {
            font-size: 1rem;
            padding: 0.5rem 1.25rem; /* Larger buttons */
            border-radius: 0.5rem; /* Rounded corners for buttons */
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 0.25rem; /* Spacing around buttons */
        }
        .mt-4 {
            margin-top: 4rem; /* Increased top margin */
        }
        .text-center {
            text-align: center; /* Center align text */
        }
        .list-group {
            margin-top: 2rem; /* Increased top margin for the list */
        }
        .list-group-item {
            padding: 1rem; /* Increased padding for list items */
        }
        .return-link {
            margin-top: 2rem; /* Add space above the return link */
        }
    </style>
</head>
<body>
    <header>
        <div style="text-align: right;">
            <a href="{% url 'logout' %}" class="btn btn-danger">Logout</a>
        </div>
    </header>

    <div class="container mt-4 text-center">
        <h1>Welcome, {{ user.username|capfirst }}! Viewing complaint {{ complaints.id }}</h1>
        <hr>
        <h2>Complaints Overview</h2>
        <div class="list-group mt-4">
            <h5 class="list-group-item-heading mb-1">{{ complaints.name }}</h5>
            <p class="list-group-item-text mb-1">Location: {{ complaints.location }}</p>
            <p class="list-group-item-text mb-1">Description: {{ complaints.description|truncatechars:100 }}</p>
            {% if complaints.upload %}
                {% if complaints.is_image %}
                    <img src="{{ complaints.upload.url }}" alt="Image preview" class="img-fluid">
                {% elif complaints.is_pdf %}
                    <iframe src="{{ complaints.upload.url }}" width="100%" height="200"></iframe>
                {% elif complaints.is_text %}
                    <a href="{{ complaints.upload.url }}" target="_blank">View Text File</a>
                {% else %}
                    <a href="{{ complaints.upload.url }}" target="_blank">Download File</a>
                {% endif %}
            {% endif %}
            {% if complaints.user %}
                <small>By: {{ complaints.user.username }}</small>
            {% else %}
                <small>By: Anonymous</small>
            {% endif %}
            {% if complaints.review %}
                <small>{{ complaints.review }}</small>
            {% endif %}
            <small>{{ complaints.status }}</small>
            <form action="/dashboard/" method="post" id="complaintForm">
                {% csrf_token %}
                <input type="hidden" id="status" name="status" value="in_progress">
                <label for="review">Enter your review:</label><br>
                <textarea id="review" name="review" rows="4" cols="50"></textarea><br>
                <button type="submit" class="btn btn-primary mt-2">Submit</button>
            </form>
        </div>
    </div>

    <div class="return-link text-center">
        <a href="/dashboard/">Back to dashboard</a>
    </div>

    <script>
        document.getElementById("complaintForm").addEventListener("submit", function(event) {
            // Get the value from the review textarea
            var review = document.getElementById("review").value;
            // Set the value of the status input field to the review value
            document.getElementById("status").value = review;
            // Allow the form submission to proceed
            return true;
        });
    </script>
</body>
</html>
