{% load static %}
{% load django_bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}

<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Admin Dashboard</title>
</head>
<body>
   <div class="container mt-4 text-center">
       <h1>Welcome, {{ user.username }}! Viewing complaint {{ complaints.first.id }}</h1>
       <a href="{% url 'logout' %}" class="btn btn-danger">Logout</a>
       <hr>
       <h2>Complaints Overview</h2>
       <div class="list-group mt-4">
               {% with complaint=complaints.first %}
                   <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                       <div class="d-flex w-100 justify-content-between">
                           <h5 class="mb-1">{{ complaint.name }}</h5>
                           <small>Submitted: {{ complaint.created_at|date:"F d, Y H:i" }}</small>
                       </div>
                       <p class="mb-1">Location: {{ complaint.location }}</p>
                       <p class="mb-1">Description: {{ complaint.description|truncatechars:100 }}</p>
                       {% if complaint.upload %}
                           {% if complaint.is_image %}
                           <img src="{{ complaint.upload.url }}" alt="Image preview" class="img-fluid">
                           {% elif complaint.is_pdf %}
                           <iframe src="{{ complaint.upload.url }}" width="100%" height="200"></iframe>
                           {% elif complaint.is_text %}
                           <a href="{{ complaint.upload.url }}" target="_blank">View Text File</a>
                           {% else %}
                           <a href="{{ complaint.upload.url }}" target="_blank">Download File</a>
                           {% endif %}
                       {% endif %}
                       {% if complaint.user %}
                           <small>By: {{ complaint.user.username }}</small>
                       {% else %}
                           <small>By: Anonymous</small>
                       {% endif %}
                       {% if complaint.review %}
                           <small>{{ complaint.review }}</small>
                       {% endif %}
                       <small>{{ complaint.status }}</small>
                       {% if complaint.status == 'reviewed' %}
                           <p>Status: Reviewed</p>
                       {% elif complaint.status == 'in_progress' %}
                           <form action="{% url 'handle_complaint_click' complaint.id %}" method="post">
                               {% csrf_token %}
                               <label for="status">Set Status:</label>
                               <select id="status" name="status">
                                   <option value="in_progress" selected>In Progress</option>
                                   <option value="reviewed">Reviewed</option>
                               </select>
                               <button type="submit" class="btn btn-primary">Submit</button>
                           </form>
                       {% else %}
                           <form action="{% url 'handle_complaint_click' complaint.id %}" method="post">
                               {% csrf_token %}
                               <label for="status">Set Status:</label>
                               <select id="status" name="status">
                                   <option value="in_progress">In Progress</option>
                                   <option value="reviewed">Reviewed</option>
                                   <option value="resolved">Resolved</option>
                                   <!-- Add more options as needed -->
                               </select>
                               <button type="submit" class="btn btn-primary">Submit</button>
                           </form>
                       {% endif %}
                   </a>
               {% endwith %}
         
       </div>
   </div>
</body>
</html>
